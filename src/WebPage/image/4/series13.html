
<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <link type="text/css" rel="stylesheet" href="lines.css"/>
  </head>
  
  <body>
	
	   <form id="disc">
			Selecione a disciplina:
			<select id="ldisciplinas" onchange="selectCourses()">
			  	<option>aa</option>
				<option>adm</option>
				<option>adsd</option>
				<option>atal</option>
				<option>basquetefem</option>
				<option>basquetmas</option>
				<option>bd1</option>
				<option>bd2</option>
				<option>calculo1</option>
				<option>calculo2</option>
				<option>calculo3</option>
				<option>classica</option>
				<option>compiladores</option>
				<option>concorrente</option>
				<option>didatica</option>
				<option>didatica2</option>
				<option>diferenciais</option>
				<option>direito</option>
				<option>discreta</option>
				<option>economia</option>
				<option>eda</option>
				<option>empreendedorismo</option>
				<option>emsoft</option>
				<option>eptgm2</option>
				<option>es</option>
				<option>estagio</option>
				<option>estagio2</option>
				<option>eti</option>
				<option>formais</option>
				<option>financeira</option>
				<option>futsal</option>
				<option>gi</option>
				<option>grafica</option>
				<option>grafos</option>
				<option>gredes</option>
				<option>ia</option>
				<option>iarquitet</option>
				<option>infosoc</option>
				<option>ingles</option>
				<option>introducao</option>
				<option>irc</option>
				<option>leda</option>
				<option>les</option>
				<option>linear</option>
				<option>lirc</option>
				<option>loac</option>
				<option>logica</option>
				<option>lp1</option>
				<option>lp2</option>
				<option>lpt</option>
				<option>metodologia</option>
				<option>metodos</option>
				<option>moderna</option>
				<option>msn</option>
				<option>mvirtuais</option>
				<option>neurais</option>
				<option>oac</option>
				<option>p1</option>
				<option>p2</option>
				<option>plp</option>
				<option>predes</option>
				<option>probabilidade</option>
				<option>projeto1</option>
				<option>projeto2</option>
				<option>realidadevirtual</option>
				<option>quimica</option>
				<option>redes</option>
				<option>redesadhoc</option>
				<option>relacoeshumanas</option>
				<option>segredes</option>
				<option>seminarios</option>
				<option>si1</option>
				<option>si2</option>
				<option>sig</option>
				<option>so</option>
				<option>socind</option>
				<option>srecuperacao</option>
				<option>teoria</option>
				<option>vetorial</option>
				<option>visaocomp</option>
			</select>
			
		</form>
		
		<form id="cperiodo">
			Selecione o periodo
			<select id="lperiodos" onchange="selectPeriodo()">
			  <option>20111</option>
			  <option>20112</option>  
			  <option>20121</option>
			  <option>20122</option>
			  <option>20132</option>
			</select>
			<p>Periodo escolhido: <input type="text" id="favorite" size="20"></p>
			
		</form>
		
    <script type="text/javascript" src="http://mbostock.github.io/d3/talk/20111116/d3/d3.js"></script>
    <script type="text/javascript" src="http://mbostock.github.io/d3/talk/20111116/d3/d3.csv.js"></script>
    <script type="text/javascript">

				var traits = ["Nota1","Nota2","Nota3","Final"];

				var disciplina = "nada";
				var periodo_index = 1;
				var periodosData = ["periodo20111.csv","periodo20112.csv","periodo20121.csv","periodo20122.csv"];
				

				
				var m = [80, 160, 200, 160],
					w = 1280 - m[1] - m[3],
					h = 800 - m[0] - m[2];

				var x = d3.scale.ordinal().domain(traits).rangePoints([0, w]),
					y = {};

				var line = d3.svg.line(),				
					axis = d3.svg.axis().orient("left"),
					foreground;

				var svg = d3.select("body").append("svg:svg")
					.attr("width", w + m[1] + m[3])
					.attr("height", h + m[0] + m[2])
				    .append("svg:g")
					.attr("transform", "translate(" + m[3] + "," + m[0] + ")");
					
				var tooltip = d3.select("body")
							.append("div")	
							.style("position", "absolute","red")
							.style("z-index", "10")
							.style("visibility", "hidden")
							.style("stroke","red")							
							//.style({color: 'blue'});
					

			d3.select(cperiodo)
				.on("click", function() {
					d3.select("svg").remove();
				
				svg = d3.select("body").append("svg:svg")
					.attr("width", w + m[1] + m[3])
					.attr("height", h + m[0] + m[2])
				    .append("svg:g")
					.attr("transform", "translate(" + m[3] + "," + m[0] + ")");
				
				buildLines();
			});
							
			//On click, update with new data			
			d3.select(disc)
				.on("click", function() {		
				
				d3.select("svg").remove();
				
				svg = d3.select("body").append("svg:svg")
					.attr("width", w + m[1] + m[3])
					.attr("height", h + m[0] + m[2])
				    .append("svg:g")
					.attr("transform", "translate(" + m[3] + "," + m[0] + ")");
				
				buildLines();

				
			});	
			
			
			function buildLines(){
				//d3.csv.remove();
				d3.csv(periodosData[periodo_index], function(dadosNotas) {

				  // Create a scale and brush for each trait.
				  
				  
				  traits.forEach(function(d) {
					// Coerce values to numbers.
					dadosNotas.forEach(function(p) { p[d] = +p[d]; });

					y[d] = d3.scale.linear()
						.domain([0,10])
						.range([h, 0]);

					y[d].brush = d3.svg.brush()
						.y(y[d])
						.on("brush", brush);
				 });

				 mostralinhas(dadosNotas);
				 

				  // Add a group element for each trait.
				  var g = svg.selectAll(".trait")
					  .data(traits)
					.enter().append("svg:g")
					  .attr("class", "trait")
					  .attr("transform", function(d) { return "translate(" + x(d) + ")"; })
					  .call(d3.behavior.drag()
					  .origin(function(d) { return {x: x(d)}; })
					  .on("dragstart", dragstart)
					  .on("drag", drag)
					  .on("dragend", dragend));
					  

				  // Add an axis and title.
				  g.append("svg:g")
					  .attr("class", "axis")
					  .each(function(d) { d3.select(this).call(axis.scale(y[d])); })
					.append("svg:text")
					  .attr("text-anchor", "middle")
					  .attr("y", -9)
					  .text(String)
					  

				  // Add a brush for each axis.
				   g.append("svg:g")
					  .attr("class", "brush")
					  .each(function(d) { d3.select(this).call(y[d].brush); })
					.selectAll("rect")
					  .attr("x", -8)
					  .attr("width", 16);


				  function dragstart(d) {
					i = traits.indexOf(d);
				  }

				  function drag(d) {
					x.range()[i] = d3.event.x;
					traits.sort(function(a, b) { return x(a) - x(b); });
					g.attr("transform", function(d) { return "translate(" + x(d) + ")"; });
					foreground.attr("d", path);
				  }

				  function dragend(d) {
					x.domain(traits).rangePoints([0, w]);
					var t = d3.transition().duration(500);
					t.selectAll(".trait").attr("transform", function(d) { return "translate(" + x(d) + ")"; });
					t.selectAll(".foreground path").attr("d", path);
				  }
				});
			}
				
				function selectCourses()
				{
					var mylist=document.getElementById("ldisciplinas");
					disciplina = mylist.options[mylist.selectedIndex].text;
					//document.write(" ["+disciplina+"] ");
				}
				

				function selectPeriodo()
				{
					var mylist=document.getElementById("lperiodos");
					periodo_index = mylist.selectedIndex;
					document.getElementById("favorite").value=periodo_index;//periodo_index;//periodosData[periodo_index];
				
				}
				
				// Returns the path for a given data point.
				function path(d) {
				  return line(traits.map(function(p) { return [x(p), y[p](d[p])]; }));
				}

				// Handles a brush event, toggling the display of foreground lines.
				function brush() {
				  var actives = traits.filter(function(p) { return !y[p].brush.empty(); }),
					  extents = actives.map(function(p) { return y[p].brush.extent(); });
				  foreground.classed("fade", function(d) {
					return actives.every(function(p, i) {
					  return !(extents[i][1] <= d[p] || d[p] <= extents[i][0]);
					});
				  });
				}
				
				
				function mostralinhas(dados) {
				
				  // E Aqui que as linhas aparecem.
				  foreground = svg.append("svg:g")
					  .attr("class", "foreground")
					.selectAll("path")
					  .data(dados)	   					  
					 .enter().append("svg:path")
					  .attr("d", path)
					  .attr("class", function(d) { 
					  
					        if (disciplina == d.disciplinas) {
							
							return disciplina;
							
							 } 
					  
					  })
					  
					  .on("mouseover", function(d) { 
					  
						tooltip.text(d.disciplinas+"\n"+d.media).attr("fill", "red");
					        return tooltip.style("visibility", "visible");
					  
					  
					  })
					  .on("mousemove", function(){
					  
					                return tooltip.style("top", (event.pageY-10)+"px").style("left",(event.pageX+14)+"px").style({color: 'blue'});
					   ;})
					  .on("mouseout", function(){return tooltip.style("visibility", "hidden");});
					  
				}

    </script>    
  </body>
</html>
